CREATE PROCEDURE [Data_Load].[SaveDataLock]
	@DataLockId BIGINT,
    @ProcessDateTime DATETIME,
    @IlrFileName NVARCHAR(50),
    @UkPrn BIGINT,
    @Uln BIGINT,
    @LearnRefNumber NVARCHAR(12),
	@AimSeqNumber BIGINT,
    @PriceEpisodeIdentifier VARCHAR(25),
    @ApprenticeshipId BIGINT,
    @EmployerAccountId BIGINT,
    @EventSource INT,
	@HasErrors BIT,
    @IlrStartDate DATE = NULL,
    @IlrStandardCode BIGINT = NULL,
    @IlrProgrammeType INT = NULL,
    @IlrFrameworkCode INT = NULL,
    @IlrPathwayCode INT = NULL,
    @IlrTrainingPrice DECIMAL(12,5) = NULL,
    @IlrEndpointAssessorPrice DECIMAL(12,5) = NULL,
    @IlrPriceEffectiveFromDate DATE = NULL,
    @IlrPriceEffectiveToDate DATE = NULL,
	@ErrorCode VARCHAR(15),
	@SystemDescription	 NVARCHAR(255),
	@CollectionPeriodName VARCHAR(8),
	@CollectionPeriodMonth INT,
	@CollectionPeriodYear INT,
	@ApprenticeshipVersion VARCHAR(25),
	@IsPayable BIT,
	@TransactionType INT,
	@Version VARCHAR(25) = NULL,
	@StartDate DATE = NULL,
	@StandardCode BIGINT = NULL,
	@ProgrammeType INT = NULL,
	@FrameworkCode INT = NULL,
	@PathwayCode	 INT = NULL,
	@NegotiatedPrice DECIMAL(15, 2) = NULL,
	@EffectiveDate DATE = NULL
AS
BEGIN
	SET NOCOUNT ON;
	IF NOT EXISTS(SELECT TOP 1 1 FROM [Data_Load].[DAS_DataLocks] WHERE DataLockId = @DataLockId)
	BEGIN

		INSERT INTO [Data_Load].[DAS_DataLocks]
		(
			[DataLockId],
			[ProcessDateTime],
			[IlrFileName],
			[UkPrn],
			[Uln],
			[LearnRefNumber],
			[AimSeqNumber],
			[PriceEpisodeIdentifier],
			[ApprenticeshipId],
			[EmployerAccountId],
			[EventSource],
			[HasErrors],
			[IlrStartDate],
			[IlrStandardCode],
			[IlrProgrammeType],
			[IlrFrameworkCode],
			[IlrPathwayCode],
			[IlrTrainingPrice],
			[IlrEndpointAssessorPrice],
			[IlrPriceEffectiveFromDate],
			[IlrPriceEffectiveToDate],
			[ErrorCode],
			[SystemDescription],
			[CollectionPeriodName],
			[CollectionPeriodMonth],
			[CollectionPeriodYear],
			[ApprenticeshipVersion],
			[IsPayable],
			[TransactionType],
			[Version],
			[StartDate],
			[StandardCode],
			[ProgrammeType],
			[FrameworkCode],
			[PathwayCode],
			[NegotiatedPrice],
			[EffectiveDate]
		)
		VALUES
		(
			@DataLockId,
			@ProcessDateTime,
			@IlrFileName,
			@UkPrn,
			@Uln,
			@LearnRefNumber,
			@AimSeqNumber,
			@PriceEpisodeIdentifier,
			@ApprenticeshipId,
			@EmployerAccountId,
			@EventSource,
			@HasErrors,
			@IlrStartDate,
			@IlrStandardCode,
			@IlrProgrammeType,
			@IlrFrameworkCode,
			@IlrPathwayCode,
			@IlrTrainingPrice,
			@IlrEndpointAssessorPrice,
			@IlrPriceEffectiveFromDate,
			@IlrPriceEffectiveToDate,
			@ErrorCode,
			@SystemDescription,
			@CollectionPeriodName,
			@CollectionPeriodMonth,
			@CollectionPeriodYear,
			@ApprenticeshipVersion,
			@IsPayable,
			@TransactionType,
			@Version,
			@StartDate,
			@StandardCode,
			@ProgrammeType,
			@FrameworkCode,
			@PathwayCode,
			@NegotiatedPrice,
			@EffectiveDate
		)

	END
END
GO
